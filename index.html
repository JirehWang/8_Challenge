<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«æ ¼æŒ‘æˆ°ï¼šåœ–ç‰‡éš¨æ©Ÿç”¢ç”Ÿå™¨</title>
    <style>
        :root { --accent: #6c5ce7; --bg: #0f0c29; }
        body { font-family: 'PingFang TC', sans-serif; background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        /* è·‘é¦¬ç‡ˆé¡¯ç¤ºå€åŸŸ */
        .display-box {
            width: 350px; height: 350px; background: #000; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 50px rgba(108, 92, 231, 0.6); margin: 30px 0;
            border: 5px solid white; overflow: hidden; position: relative;
        }

        #result-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        #placeholder-text { font-size: 20px; color: #888; text-align: center; padding: 20px; }

        .settings {
            background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 15px;
            width: 100%; max-width: 450px; backdrop-filter: blur(10px);
        }

        .control-item { margin: 15px 0; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        
        input[type="file"], input[type="text"], input[type="range"] {
            width: 100%; box-sizing: border-box; background: rgba(255,255,255,0.9); border-radius: 5px; padding: 8px;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button {
            flex: 1; padding: 15px; font-size: 18px; border: none; border-radius: 10px;
            cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        #startBtn { background: #00b894; color: white; }
        #stopBtn { background: #d63031; color: white; }
        button:disabled { opacity: 0.3; }

        .status { font-size: 14px; margin-top: 5px; color: #aaa; }
    </style>
</head>
<body>

    <h1>ğŸ¡ å…«æ ¼æŒ‘æˆ°ï¼šéš¨æ©Ÿåœ–ç‰‡æŠ½ç±¤</h1>

    <div class="display-box" id="displayBox">
        <img id="result-img" src="" alt="æŒ‘æˆ°å…§å®¹">
        <div id="placeholder-text">è«‹å…ˆä¸Šå‚³åœ–ç‰‡å¾ŒæŒ‰ä¸‹ã€Œé–‹å§‹ã€</div>
    </div>

    <div class="settings">
        <div class="control-item">
            <label>ğŸ–¼ï¸ ä¸Šå‚³ 8 å¼µåœ–ç‰‡ï¼š</label>
            <input type="file" id="imageInput" accept="image/*" multiple>
            <div class="status" id="fileStatus">ç›®å‰å·²é¸æ“‡ 0 å¼µ</div>
        </div>

        <div class="control-item">
            <label>âš¡ æ—‹è½‰é€Ÿåº¦ (æ¯«ç§’)ï¼š</label>
            <input type="range" id="speedRange" min="30" max="500" value="80">
            <span id="speedVal">80ms</span>
        </div>

        <div class="control-item">
            <label>ğŸµ éŸ³æ¨‚ç¶²å€ (MP3)ï¼š</label>
            <input type="text" id="musicUrl" placeholder="ä¾‹å¦‚: https://example.com/bgm.mp3">
        </div>

        <div class="btn-group">
            <button id="startBtn" onclick="startChallenge()">START</button>
            <button id="stopBtn" onclick="stopChallenge()" disabled>STOP / æˆªåœ–</button>
        </div>
    </div>

    <audio id="bgm" loop></audio>

    <script>
        let images = [];
        let timer = null;
        const imgDisplay = document.getElementById('result-img');
        const placeholder = document.getElementById('placeholder-text');
        const imageInput = document.getElementById('imageInput');
        const fileStatus = document.getElementById('fileStatus');
        const audio = document.getElementById('bgm');

        // ç›£è½åœ–ç‰‡ä¸Šå‚³ä¸¦è½‰ç‚º Base64
        imageInput.onchange = (e) => {
            const files = Array.from(e.target.files);
            images = [];
            fileStatus.innerText = `è®€å–ä¸­...`;
            
            let loadedCount = 0;
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    images.push(event.target.result);
                    loadedCount++;
                    if (loadedCount === files.length) {
                        fileStatus.innerText = `å·²æˆåŠŸè¼‰å…¥ ${images.length} å¼µåœ–ç‰‡`;
                    }
                };
                reader.readAsDataURL(file);
            });
        };

        // é€Ÿåº¦æ•¸å€¼æ›´æ–°
        document.getElementById('speedRange').oninput = function() {
            document.getElementById('speedVal').innerText = this.value + 'ms';
        };

        function startChallenge() {
            if (images.length === 0) return alert('è«‹å…ˆä¸Šå‚³è‡³å°‘ä¸€å¼µåœ–ç‰‡ï¼');
            
            const speed = document.getElementById('speedRange').value;
            const musicLink = document.getElementById('musicUrl').value;

            // éŸ³æ¨‚æ’­æ”¾
            if (musicLink) {
                audio.src = musicLink;
                audio.play().catch(() => console.log("éœ€é»æ“Šå¾Œæ’­æ”¾"));
            }

            placeholder.style.display = 'none';
            imgDisplay.style.display = 'block';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;

            // é–‹å§‹è¼ªæ’­
            timer = setInterval(() => {
                const randomIdx = Math.floor(Math.random() * images.length);
                imgDisplay.src = images[randomIdx];
            }, speed);
        }

        function stopChallenge() {
            clearInterval(timer);
            audio.pause();
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
    </script>
</body>
</html>
