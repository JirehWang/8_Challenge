<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«æ ¼æŒ‘æˆ°ï¼šå¤šé¡Œçµ„éš¨æ©Ÿç‰ˆ</title>
    <style>
        :root { --bg: #121212; --panel: #252525; --accent: #00fbff; }
        body { font-family: sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .setup-area { background: var(--panel); padding: 20px; border-radius: 15px; width: 100%; max-width: 800px; margin-bottom: 20px; }
        .group-config { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 10px; }
        .group-item { background: #333; padding: 10px; border-radius: 8px; font-size: 14px; }
        
        .game-controls { margin: 20px 0; display: flex; gap: 15px; align-items: center; }
        select, button { padding: 10px 20px; border-radius: 5px; border: none; font-size: 16px; cursor: pointer; }
        #startBtn { background: var(--accent); color: #000; font-weight: bold; }
        
        /* 4x2 ç¶²æ ¼ */
        .grid-container {
            display: grid; grid-template-columns: repeat(4, 150px); grid-template-rows: repeat(2, 150px);
            gap: 15px; margin-top: 20px;
        }
        .box {
            width: 150px; height: 150px; background: #333; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 2px solid #444; position: relative;
        }
        .box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .box.show img { display: block; }
        .box::before { content: '?'; font-size: 30px; color: #555; position: absolute; }
        .box.show::before { display: none; }

        #timer { font-size: 40px; color: #ff4757; font-family: monospace; margin: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ™ï¸ å…«æ ¼æŒ‘æˆ°ï¼šé¡Œçµ„éš¨æ©Ÿç‰ˆ</h1>

    <div class="setup-area">
        <h3>1. è¨­å®šé¡Œçµ„ (æ¯çµ„è«‹å‚³ 8 å¼µ)</h3>
        <div class="group-config">
            <div class="group-item">
                <label>é¡Œçµ„ Aï¼š</label><input type="file" multiple onchange="loadGroup(0, this)">
                <div id="status0">æœªè¼‰å…¥</div>
            </div>
            <div class="group-item">
                <label>é¡Œçµ„ Bï¼š</label><input type="file" multiple onchange="loadGroup(1, this)">
                <div id="status1">æœªè¼‰å…¥</div>
            </div>
            <div class="group-item">
                <label>é¡Œçµ„ Cï¼š</label><input type="file" multiple onchange="loadGroup(2, this)">
                <div id="status2">æœªè¼‰å…¥</div>
            </div>
            <div class="group-item">
                <label>é¡Œçµ„ Dï¼š</label><input type="file" multiple onchange="loadGroup(3, this)">
                <div id="status3">æœªè¼‰å…¥</div>
            </div>
        </div>
    </div>

    <div class="game-controls">
        <select id="groupSelect">
            <option value="0">ä½¿ç”¨ é¡Œçµ„ A</option>
            <option value="1">ä½¿ç”¨ é¡Œçµ„ B</option>
            <option value="2">ä½¿ç”¨ é¡Œçµ„ C</option>
            <option value="3">ä½¿ç”¨ é¡Œçµ„ D</option>
        </select>
        <span>ç§’æ•¸ï¼š</span>
        <input type="number" id="secInput" value="10" style="width: 50px; padding: 8px;">
        <button id="startBtn" onclick="startChallenge()">é–‹å§‹éš¨æ©ŸæŒ‘æˆ°</button>
    </div>

    <div id="timer">--</div>

    <div class="grid-container" id="mainGrid">
        <div class="box" id="b0"></div><div class="box" id="b1"></div><div class="box" id="b2"></div><div class="box" id="b3"></div>
        <div class="box" id="b4"></div><div class="box" id="b5"></div><div class="box" id="b6"></div><div class="box" id="b7"></div>
    </div>

    <script>
        let allGroups = [[], [], [], []]; // å­˜æ”¾å››å€‹é¡Œçµ„çš„åœ–ç‰‡

        function loadGroup(idx, input) {
            const files = Array.from(input.files);
            allGroups[idx] = [];
            let count = 0;
            files.forEach(f => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    allGroups[idx].push(e.target.result);
                    count++;
                    document.getElementById(`status${idx}`).innerText = `å·²è¼‰å…¥ ${count} å¼µ`;
                };
                reader.readAsDataURL(f);
            });
        }

        function startChallenge() {
            const groupIdx = document.getElementById('groupSelect').value;
            const sourceImages = allGroups[groupIdx];
            
            if (sourceImages.length < 4) {
                alert("è©²é¡Œçµ„åœ–ç‰‡ä¸è¶³ 4 å¼µï¼");
                return;
            }

            // 1. æ¸…é™¤èˆŠç‹€æ…‹
            const boxes = document.querySelectorAll('.box');
            boxes.forEach(b => { b.innerHTML = ""; b.classList.remove('show'); });

            // 2. å¾è©²é¡Œçµ„éš¨æ©Ÿé¸ 4 å¼µä¸é‡è¤‡çš„åœ–
            const shuffledImgs = [...sourceImages].sort(() => 0.5 - Math.random());
            const selectedImgs = shuffledImgs.slice(0, 4);

            // 3. éš¨æ©Ÿæ±ºå®šé€™ 4 å¼µåœ–è¦æ”¾åœ¨ 8 å€‹ä½ç½®ä¸­çš„å“ªå¹¾å€‹
            const positions = [0, 1, 2, 3, 4, 5, 6, 7].sort(() => 0.5 - Math.random());
            const selectedPos = positions.slice(0, 4);

            // 4. å¡«å…¥åœ–ç‰‡
            selectedPos.forEach((pos, index) => {
                const img = document.createElement('img');
                img.src = selectedImgs[index];
                document.getElementById(`b${pos}`).appendChild(img);
                document.getElementById(`b${pos}`).classList.add('show');
            });

            // 5. å€’æ•¸è¨ˆæ™‚
            let sec = parseInt(document.getElementById('secInput').value);
            const timerEl = document.getElementById('timer');
            timerEl.innerText = sec;

            const countdown = setInterval(() => {
                sec--;
                timerEl.innerText = sec;
                if (sec <= 0) {
                    clearInterval(countdown);
                    timerEl.innerText = "æ™‚é–“åˆ°ï¼";
                    boxes.forEach(b => b.classList.remove('show')); // éš±è—åœ–ç‰‡
                }
            }, 1000);
        }
    </script>
</body>
</html>
