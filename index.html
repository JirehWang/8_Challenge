<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«æ ¼å¿«é€Ÿæœ—è®€æŒ‘æˆ°</title>
    <style>
        :root { --bg: #1e1e1e; --text: #eee; --accent: #00cec9; }
        body { font-family: 'PingFang TC', sans-serif; background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        h1 { color: var(--accent); margin-bottom: 10px; }

        /* è¨­å®šé¢æ¿ */
        .settings-panel {
            background: rgba(255, 255, 255, 0.05); padding: 15px 25px; border-radius: 10px;
            margin-bottom: 20px; text-align: center; width: 90%; max-width: 600px;
        }
        .control-group { margin: 10px 0; display: flex; align-items: center; justify-content: center; gap: 15px; }
        input[type="range"] { width: 150px; }
        
        button {
            padding: 10px 25px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s;
        }
        #startBtn { background-color: #0984e3; color: white; }
        #resetBtn { background-color: #636e72; color: white; margin-left: 10px;}
        button:hover { opacity: 0.8; }
        button:disabled { background-color: #333; cursor: not-allowed; opacity: 0.5; }

        /* å€’æ•¸è¨ˆæ™‚é¡¯ç¤º */
        #timer-display { font-size: 36px; font-weight: bold; color: #fab1a0; margin: 10px 0; height: 40px; }
        #game-status { font-size: 18px; margin-bottom: 15px; color: #aaa; }

        /* å…«å®®æ ¼å€åŸŸ */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4æ¬„ */
            grid-template-rows: repeat(2, 1fr);    /* 2åˆ— */
            gap: 15px;
            width: 100%; max-width: 800px;
            margin-top: 10px;
        }

        .box {
            position: relative;
            background-color: #333;
            aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢ */
            border-radius: 8px;
            overflow: hidden;
            border: 3px solid transparent;
            transition: border-color 0.3s;
        }
        
        /* æŒ‘æˆ°ä¸­é«˜äº®æ ¼å­ */
        .box.active { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 206, 201, 0.5); }

        .box img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.1s; }
        
        /* éŠæˆ²é–‹å§‹æ™‚é¡¯ç¤ºåœ–ç‰‡ */
        .grid-container.playing .box img { opacity: 1; }
        
        /* éŠæˆ²çµæŸæˆ–æº–å‚™æ™‚çš„é®ç½© */
        .box::after {
            content: '?'; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #444; color: #888; display: flex; align-items: center; justify-content: center;
            font-size: 40px; font-weight: bold; opacity: 1; transition: opacity 0.1s;
        }
        .grid-container.playing .box::after { opacity: 0; } /* é–‹å§‹æ™‚éš±è—å•è™Ÿ */

    </style>
</head>
<body>

    <h1>ğŸ™ï¸ å…«æ ¼å¿«é€Ÿæœ—è®€æŒ‘æˆ°</h1>

    <div class="settings-panel">
        <div class="control-group">
            <label>ğŸ–¼ï¸ 1. ä¸Šå‚³ 8 å¼µåœ–ç‰‡ï¼š</label>
            <input type="file" id="imageInput" accept="image/*" multiple>
        </div>
        <div class="control-group">
            <label>â±ï¸ 2. æŒ‘æˆ°æ™‚é–“ï¼š</label>
            <input type="range" id="timeRange" min="3" max="30" value="10">
            <span id="timeVal">10ç§’</span>
        </div>
        <div class="control-group">
            <label>ğŸµ 3. éŸ³æ¨‚æª”æ¡ˆç¶²å€ï¼š</label>
            <input type="text" id="musicUrl" placeholder="mp3 é€£çµ (å¾Œè£œ)">
        </div>
        <div class="control-group" style="margin-top: 15px;">
            <button id="startBtn" onclick="startGame()">é–‹å§‹æŒ‘æˆ°</button>
            <button id="resetBtn" onclick="resetGame()">é‡ç½®</button>
        </div>
    </div>

    <div id="game-status">è«‹ä¸Šå‚³åœ–ç‰‡å¾ŒæŒ‰ã€Œé–‹å§‹ã€</div>
    <div id="timer-display"></div>

    <div class="grid-container" id="grid">
        <div class="box"><img id="img0"></div>
        <div class="box"><img id="img1"></div>
        <div class="box"><img id="img2"></div>
        <div class="box"><img id="img3"></div>
        <div class="box"><img id="img4"></div>
        <div class="box"><img id="img5"></div>
        <div class="box"><img id="img6"></div>
        <div class="box"><img id="img7"></div>
    </div>

    <audio id="bgm"></audio>

    <script>
        let images = [];
        let challengeTimer = null;
        let timeLeft = 0;
        const grid = document.getElementById('grid');
        const startBtn = document.getElementById('startBtn');
        const timerDisplay = document.getElementById('timer-display');
        const statusDisplay = document.getElementById('game-status');
        const audio = document.getElementById('bgm');

        // æ™‚é–“æ•¸å€¼æ›´æ–°
        document.getElementById('timeRange').oninput = function() {
            document.getElementById('timeVal').innerText = this.value + 'ç§’';
        };

        // è™•ç†åœ–ç‰‡ä¸Šå‚³
        document.getElementById('imageInput').onchange = (e) => {
            const files = Array.from(e.target.files).slice(0, 8); // åªå–å‰8å¼µ
            images = [];
            
            let loadedCount = 0;
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById(`img${index}`).src = event.target.result;
                    images.push(event.target.result);
                    loadedCount++;
                    if (loadedCount === files.length) {
                        statusDisplay.innerText = `æˆåŠŸè¼‰å…¥ ${images.length} å¼µåœ–ç‰‡ï¼Œæº–å‚™å¥½äº†å—ï¼Ÿ`;
                        if(images.length < 8) statusDisplay.innerText += " (ä¸è¶³ 8 å¼µï¼Œå°‡åªé¡¯ç¤ºéƒ¨åˆ†)";
                    }
                };
                reader.readAsDataURL(file);
            });
        };

        function startGame() {
            if (images.length === 0) return alert('è«‹å…ˆä¸Šå‚³åœ–ç‰‡ï¼');
            
            const duration = parseInt(document.getElementById('timeRange').value);
            const musicLink = document.getElementById('musicUrl').value;
            timeLeft = duration;

            // åˆå§‹åŒ–ç‹€æ…‹
            startBtn.disabled = true;
            grid.classList.add('playing'); // é¡¯ç¤ºåœ–ç‰‡ï¼Œéš±è—å•è™Ÿ
            statusDisplay.innerText = "å”¸å‡ºä¾†ï¼";
            timerDisplay.innerText = `${timeLeft}s`;

            // éŸ³æ¨‚è™•ç†
            if (musicLink) {
                audio.src = musicLink;
                audio.play().catch(() => console.log("éœ€äº’å‹•æ‰å¯æ’­æ”¾"));
            }

            // é–‹å§‹å€’æ•¸
            clearInterval(challengeTimer);
            challengeTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = `${timeLeft}s`;

                // çµæŸæŒ‘æˆ°
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            clearInterval(challengeTimer);
            grid.classList.remove('playing'); // éš±è—åœ–ç‰‡ï¼Œé¡¯ç¤ºå•è™Ÿ
            statusDisplay.innerText = "æŒ‘æˆ°çµæŸï¼";
            timerDisplay.innerText = "æ™‚é–“åˆ°ï¼";
            startBtn.disabled = false;
            audio.pause();
            audio.currentTime = 0; // é‡ç½®éŸ³æ¨‚
        }

        function resetGame() {
            endGame();
            statusDisplay.innerText = "å·²é‡ç½®ã€‚å¯é‡æ–°èª¿æ•´æ™‚é–“æˆ–é–‹å§‹ã€‚";
            timerDisplay.innerText = "";
        }
    </script>
</body>
</html>
