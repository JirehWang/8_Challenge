<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«æ ¼æŒ‘æˆ°ï¼šç²¾é¸4åœ–å¡«æ»¿ç‰ˆ</title>
    <style>
        :root { --bg: #1a1a1a; --card: #2d2d2d; --accent: #00d2ff; --text: #ffffff; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        
        .panel { background: var(--card); padding: 20px; border-radius: 12px; width: 90%; max-width: 900px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .setup-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .group-box { background: #3d3d3d; padding: 10px; border-radius: 8px; border: 1px solid #555; }
        .group-box label { font-size: 14px; font-weight: bold; color: var(--accent); }
        
        .game-nav { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: center; padding: 15px; border-top: 1px solid #444; }
        
        input[type="file"] { width: 100%; margin-top: 5px; font-size: 12px; }
        button { padding: 10px 25px; border-radius: 5px; border: none; font-size: 16px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        #startBtn { background: #ff4757; color: white; }
        #startBtn:hover { background: #ff6b81; transform: scale(1.05); }

        /* 4x2 ç¶²æ ¼è¨­è¨ˆ */
        .grid-container {
            display: grid; grid-template-columns: repeat(4, 180px); grid-template-rows: repeat(2, 180px);
            gap: 15px; margin-top: 30px;
        }
        .box {
            width: 180px; height: 180px; background: #333; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 3px solid #444; position: relative;
        }
        .box img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .box.active img { display: block; }
        .box::before { content: 'ï¼Ÿ'; font-size: 40px; color: #555; position: absolute; }
        .box.active::before { display: none; }

        #timer-text { font-size: 48px; color: #f1c40f; margin: 20px 0; font-family: monospace; text-shadow: 0 0 10px rgba(241, 196, 15, 0.5); }
    </style>
</head>
<body>

    <h1>ğŸ™ï¸ å…«æ ¼æŒ‘æˆ°ï¼š4åœ–éš¨æ©Ÿåˆ†é…</h1>

    <div class="panel">
        <div class="setup-grid">
            <div class="group-box"><label>é¡Œåº« 1 (ä¸Šå‚³8å¼µ)</label><input type="file" multiple onchange="loadImages(0, this)"><div id="s0">å¾…å‘½</div></div>
            <div class="group-box"><label>é¡Œåº« 2 (ä¸Šå‚³8å¼µ)</label><input type="file" multiple onchange="loadImages(1, this)"><div id="s1">å¾…å‘½</div></div>
            <div class="group-box"><label>é¡Œåº« 3 (ä¸Šå‚³8å¼µ)</label><input type="file" multiple onchange="loadImages(2, this)"><div id="s2">å¾…å‘½</div></div>
            <div class="group-box"><label>é¡Œåº« 4 (ä¸Šå‚³8å¼µ)</label><input type="file" multiple onchange="loadImages(3, this)"><div id="s3">å¾…å‘½</div></div>
            <div class="group-box"><label>é¡Œåº« 5 (ä¸Šå‚³8å¼µ)</label><input type="file" multiple onchange="loadImages(4, this)"><div id="s4">å¾…å‘½</div></div>
            <div class="group-box"><label>é¡Œåº« 6 (ä¸Šå‚³8å¼µ)</label><input type="file" multiple onchange="loadImages(5, this)"><div id="s5">å¾…å‘½</div></div>
        </div>

        <div class="game-nav">
            <div>
                é¸æ“‡é¡Œåº«ï¼š
                <select id="bankSelector" style="padding: 8px;">
                    <option value="0">é¡Œåº« 1</option><option value="1">é¡Œåº« 2</option>
                    <option value="2">é¡Œåº« 3</option><option value="3">é¡Œåº« 4</option>
                    <option value="4">é¡Œåº« 5</option><option value="5">é¡Œåº« 6</option>
                </select>
            </div>
            <div>
                æŒ‘æˆ°ç§’æ•¸ï¼š<input type="number" id="duration" value="8" style="width: 50px; padding: 8px;">
            </div>
            <div>
                éŸ³æ¨‚é€£çµï¼š<input type="text" id="musicUrl" placeholder="MP3 URL (å¾Œè£œ)" style="padding: 8px;">
            </div>
            <button id="startBtn" onclick="initGame()">é–‹å§‹æŒ‘æˆ°</button>
        </div>
    </div>

    <div id="timer-text">--</div>

    <div class="grid-container" id="gameGrid">
        <div class="box" id="grid-0"></div><div class="box" id="grid-1"></div><div class="box" id="grid-2"></div><div class="box" id="grid-3"></div>
        <div class="box" id="grid-4"></div><div class="box" id="grid-5"></div><div class="box" id="grid-6"></div><div class="box" id="grid-7"></div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        let banks = [[], [], [], [], [], []]; // å„²å­˜ 6 çµ„é¡Œåº«

        // è®€å–åœ–ç‰‡
        function loadImages(idx, input) {
            const files = Array.from(input.files);
            banks[idx] = [];
            let loaded = 0;
            files.forEach(f => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    banks[idx].push(e.target.result);
                    loaded++;
                    document.getElementById(`s${idx}`).innerText = `å·²è¼‰å…¥ ${loaded} å¼µ`;
                };
                reader.readAsDataURL(f);
            });
        }

        function initGame() {
            const bankIdx = document.getElementById('bankSelector').value;
            const currentBank = banks[bankIdx];

            if (currentBank.length < 8) {
                alert("è©²é¡Œåº«åœ–ç‰‡ä¸è¶³ 8 å¼µï¼Œè«‹é‡æ–°ä¸Šå‚³ï¼");
                return;
            }

            // 1. å¾ 8 å¼µä¸­éš¨æ©Ÿé¸å‡º 4 å¼µ
            const shuffledPool = [...currentBank].sort(() => 0.5 - Math.random());
            const luckyFour = shuffledPool.slice(0, 4);

            // 2. å°‡é€™ 4 å¼µåœ–å¡«å…¥ 8 å€‹æ ¼å­ (æ¯å¼µå‡ºç¾å…©æ¬¡)
            // ä½ ä¹Ÿå¯ä»¥æ”¹æˆå®Œå…¨éš¨æ©Ÿï¼šconst gridImages = Array.from({length: 8}, () => luckyFour[Math.floor(Math.random() * 4)]);
            let gridImages = [...luckyFour, ...luckyFour]; // ç¢ºä¿æ¯å¼µå‡ºç¾å…©æ¬¡ï¼Œå¹³è¡¡åº¦è¼ƒå¥½
            gridImages.sort(() => 0.5 - Math.random()); // æ‰“äº‚é€™ 8 å¼µåœ–çš„é †åº

            // 3. æ¸²æŸ“åˆ°ç¶²æ ¼
            const boxes = document.querySelectorAll('.box');
            boxes.forEach((box, i) => {
                box.innerHTML = `<img src="${gridImages[i]}">`;
                box.classList.add('active'); // é¡¯ç¤ºåœ–ç‰‡
            });

            // 4. éŸ³æ¨‚èˆ‡å€’æ•¸
            startFlow();
        }

        function startFlow() {
            const audio = document.getElementById('audioPlayer');
            const musicUrl = document.getElementById('musicUrl').value;
            const timerDisplay = document.getElementById('timer-text');
            let timeLeft = parseInt(document.getElementById('duration').value);

            if (musicUrl) {
                audio.src = musicUrl;
                audio.play();
            }

            timerDisplay.innerText = timeLeft;
            const countdown = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    timerDisplay.innerText = "æ™‚é–“åˆ°ï¼";
                    // éš±è—æ‰€æœ‰åœ–ç‰‡
                    document.querySelectorAll('.box').forEach(b => b.classList.remove('active'));
                    audio.pause();
                    audio.currentTime = 0;
                }
            }, 1000);
        }
    </script>
</body>
</html>
